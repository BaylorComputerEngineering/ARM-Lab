\chapter{Write Back}


\begin{figure}
\caption{Write Back}\label{fig:wb}
\begin{center}
\includegraphics[width=\textwidth]{../images/writeback_stage.png}
\end{center}
\end{figure}

\WrapBarrier

\section{Mux}
This stage consists on only one item, a mux to select between the output of memory and the output of the ALU.  The control is the MemtoReg control line, see Fig~\ref{fig:wb}.  Since the mux has already been tested it does not need a testbench.  The stage thus has only 3 inputs (2 data and 1 control) and one output, the result.

\section{Datapath}
You are ready to assemble the full non-pipelined datapath shown in Fig~\ref{fig:datapath}.  To do this, you will need to combine all 5 stages into datapath.v.  Stages include:
\begin{enumerate}
\item iFetch
\item iDecode
\item iExecute
\item iMemory
\item iWriteBack
\end{enumerate} 

Verify by running your set of instructions in fibI.data and testing the output.  Each instruction should execute as expected according to your Expected Results Table.  Datapath.v should be your top-level Verilog file (no additional test drivers are necessary).

\begin{figure}
\caption{Full Non-Pipelined Datapath}\label{fig:datapath}
\begin{center}
\includegraphics[width=\textwidth]{../images/non_pipelined_datapath.png}
\end{center}
\end{figure}

\section{Your Assignment}

You are to:
\begin{enumerate}
\item Create the Writeback stage consisting of one Mux.
\item Update your timing diagram that you created when you integrated previous stages.
\item Integrate all five stages into the file pipeline.v.
\item Update your Expected Results Table to include the iWriteBack stage.
\item Run simulations to verify that your results match your Expected Results table.   
\item Do not write up a lab report yet. There will be one final test to add before we submit it.
\end{enumerate} 